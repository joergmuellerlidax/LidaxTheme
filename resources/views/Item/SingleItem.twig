{% extends getPartial('page-design') %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}

{% set lang         = services.sessionStorage.getLang() %}

{% set itemData = config("Ceres.item.data") | split(', ') %}
{% set configItemName = config("Ceres.item.name") %}
{% set variations = services.item.getVariationAttributeMap( item.documents[0].data.item.id  ) %}
{% set basePriceList = getBasePriceList( services.item.getVariationList( item.documents[0].data.item.id  ) ) %}

{% block PartialHead %}
    <meta property="og:title" content="{{ item.documents[0].data.texts | itemName(configItemName) }}" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="{{ services.webstoreConfig.getWebstoreConfig().domainSsl }}{{ item.documents[0].data | itemURL }}" />
    <meta property="og:image" content="{{  item.documents[0].data.images.all[0].url }}" />
    <meta property="og:description" content="{{ item.documents[0].data.texts.shortDescription }}" />

    <link rel="canonical" href="{{ services.webstoreConfig.getWebstoreConfig().domainSsl }}{{ item.documents[0].data | itemURL }}">
    <script type="application/ld+json">{"@context":"http://schema.org/","@type":"Product","name":"{{ item.documents[0].data.texts | itemName(configItemName) }}","category":"item.","releaseDate":"{{ item.documents[0].data.variation.releasedAt }}","image":"{{ item.documents[0].data.images.all[0].urlPreview }}","identifier":"{{ item.documents[0].data.variation.id }}","description":"{{ item.documents[0].data.texts.description }}","disambiguatingDescription":"{{ item.documents[0].data.texts.shortDescription }}","manufacturer":{"@type":"Organization","name":"{{ item.documents[0].data.item.manufacturer.externalName }}"},"model":{"@type":"ProductModel","isVariantOf":"{{ item.documents[0].data.item.id }}","model":"{{ item.documents[0].data.variation.model }}"},"offers":{"@type":"Offer","priceCurrency":"{{ item.documents[0].data.calculatedPrices.default.currency }}","price":"{{ item.documents[0].data.calculatedPrices.default.price }}","availability":"{{ item.documents[0].data.variation.availability.names.name }}","itemCondition":"{{ item.documents[0].data.item.condition.name }}","serialNumber":"{{ item.documents[0].data.variation.number }}"},"depth":{"@type":"QuantitativeValue","value":"{{ item.documents[0].data.variation.lengthMM }}"},"width":{"@type":"QuantitativeValue","value":"{{ item.documents[0].data.variation.widthMM }}"},"height":{"@type":"QuantitativeValue","value":"{{ item.documents[0].data.variation.heightMM }}"},"weight":{"@type":"QuantitativeValue","value":"{{ item.documents[0].data.variation.weightG }}"}}</script>
{% endblock %}

{% set newId = services.category.get(244, lang) %}
{% set saleId = services.category.get(243, lang) %}

{% set paginatedResult      = services.itemLoader.loadForTemplate('Kiom::ItemList.ItemListView', itemLoaderPresets.categoryList, {'categoryId':21, 'page':1, 'items':4, 'facets': facetParams, 'sorting': itemSort}) %}

{% set paginatedResultSimilar      = services.itemLoader.loadForTemplate('Kiom::ItemList.ItemListView', itemLoaderPresets.categoryList, {'categoryId':21, 'page':1, 'items':2, 'facets': facetParams, 'sorting': itemSort}) %}


{% set hersteller = item.documents[0].data.item.manufacturer.name %}
{% if hersteller == "AEG" %}
    {% set herstellerURL = "/hersteller/aeg" %}
{% elseif hersteller == "Heitronic" %}
    {% set herstellerURL = "/hersteller/heitronic" %}
{% elseif hersteller == "KIOM" %}
    {% set herstellerURL = "/hersteller/kiom" %}
{% elseif hersteller == "Lead Energy" %}
    {% set herstellerURL = "/hersteller/lead-energy" %}
{% elseif hersteller == "SLV" %}
    {% set herstellerURL = "/hersteller/slv" %}
{% endif %}


{% block PageBody %}
    {{ services.lastSeen.setLastSeenMaxCount(config("Ceres.item.lists.last_seen_number")) }}

    {{ component( "Ceres::Item.Components.VariationSelect" ) }}
    {{ component( "Ceres::Item.Components.ItemImageCarousel" ) }}
    {{ component( "Kiom::Basket.Components.AddToBasket" ) }}

    <resource name="currentVariation" :data="{{ item | json_encode() }}"></resource>

    <div class="single container-max page-content">
        <div class="row">
            <div class="col-md-12">

                <a class="back-link" onclick="window.history.back()"><small><i class="fa fa-caret-left" aria-hidden="true"></i> Zurück zur Übersicht</small></a>

                <div class="row m-t-1">
                    <div class="col-md-7 single-leftside">
                        <div class="row hidden-md-up">
                            <div class="col-xs-12">
                                <h1 class="h3 title">
                                    <span v-resource-bind:currentVariation="documents.0.data.variation.name" v-resource-if:currentVariation="documents[0].data.variation.name != ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>

                                    <span v-resource-if:currentVariation="documents[0].data.variation.name == ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>
                                </h1>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <item-image-carousel image-url-accessor="url"
                                             template="#vue-item-image-carousel"></item-image-carousel>
                            </div>
                        </div>
                    </div>



                    <!-- ITEM DETAIL -->
                    <div class="col-md-5 single-rightside m-t-1">
                        <div class="row">
                            <div class="col-xs-12">
                                <h6 class="producertag hidden-sm-down">

                                    <a href="{{ herstellerURL }}" class="producer text-muted">{{ hersteller }}</a>
                                </h6>

                                <h1 class="h3 title hidden-sm-down">
                                    <span v-resource-bind:currentVariation="documents.0.data.variation.name" v-resource-if:currentVariation="documents[0].data.variation.name != ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>

                                    <span v-resource-if:currentVariation="documents[0].data.variation.name == ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>
                                </h1>
                    
                                {% if ('item.shortDescription' in itemData or 'all' in itemData) and item.documents[0].data.texts.shortDescription != '' %}
                                    <p class="single-description hidden-sm-down">{{ item.documents[0].data.texts.shortDescription }}<br />
                                    <a id="description-desktop" href="#"><i class="fa fa-angle-double-right" aria-hidden="true"></i> Mehr</a>
                                    </p>
                                    
                                {% endif %}

                                <div class="row">
                                    <div class="col-xs-6">

                                    {% set len = item.documents[0].data.images.all | length %}
                                    {% set len = len - 1 %}

                                    
                                    
                                    {% if item.documents[0].data.item.flags.flag1.text == "0" %}
                                    {% else %}
                                        {% set eekLabelString = item.documents[0].data.item.flags.flag1.text %}
                                        {% set eekArray = eekLabelString|split(' ', 2) %}
                                        {% set eekLabel = attribute(eekArray, 1) %}
                                        <div class="eek-sign 
                                        {% if eekLabel == 'A++' %} eek-aaa
                                        {% elseif eekLabel == 'A+' %} eek-aa
                                        {% elseif eekLabel == 'A' %} eek-a
                                        {% elseif eekLabel == 'B' %} eek-b
                                        {% elseif eekLabel == 'C' %} eek-c
                                        {% elseif eekLabel == 'D' %} eek-d
                                        {% elseif eekLabel == 'E' %} eek-e
                                        {% elseif eekLabel == 'EEK Skala' %} hidden-xs-up
                                        {% endif %}">
                                            <a href="{{ item.documents[0].data.images.all[len].url }}"
                                                data-lightbox="{{ item.documents[0].data.variation.id }}">
                                                <span>{{ eekLabel }}</span>
                                            </a>
                                        </div>
                                    {% endif %}          
                                          
                                        
                                        
                                        <span class="articlenumber small">
                                            <b>Art.-Nr.: </b>
                                            <span v-resource-bind:currentVariation="documents.0.data.variation.number">{{ item.documents[0].data.variation.number }}</span>
                                        </span>
                                        
                                        <div class="availability-wrapper">
                                            <span class="availability tag availability_{{ item.documents[0].data.variation.availability.id }}" v-availability-class:currentVariation>
                                                <span v-resource-bind:currentVariation="documents.0.data.variation.availability.names.name">
                                                    {{ item.documents[0].data.variation.availability.names.name }}
                                                </span>
                                            </span>

                                        </div>
                                        
                                    </div>
                                    <div class="col-xs-6">
                                        <h6 class="producertag hidden-md-up">
                                            <a href="{{ herstellerURL }}" class="producer text-muted">{{ hersteller }}</a>
                                        </h6>

                                        {% if ('item.recommendedPrice' in itemData or 'all' in itemData) %}
                                            <div class="crossprice" v-resource-if:currentVariation="documents[0].data.calculatedPrices.rrp.price > 0">
                                                <del class="text-muted small" v-resource-bind:currentVariation="documents.0.data.calculatedPrices.formatted.rrpPrice">
                                                    {{ item.documents[0].data.calculatedPrices.formatted.rrpPrice }}
                                                </del>
                                            </div>
                                        {% endif %}

                                        <span class="price h1" >
                                            <span v-resource-bind:currentVariation="documents.0.data.calculatedPrices.formatted.defaultPrice"
                                                  content="{{ item.documents[0].data.calculatedPrices.default.price }}">
                                                {{ item.documents[0].data.calculatedPrices.formatted.defaultPrice }}
                                            </span>
                                            <sup>*</sup>
                                            <span content="{{ item.documents[0].data.calculatedPrices.default.currency }}"></span>
                                        </span>

                                        <div class="base-price text-muted m-y-1">
                                            {{ trans("Ceres::Template.itemUnitPrice") }}
                                            <span class="base-price-value" v-resource-bind:currentVariation="documents.0.data.calculatedPrices.formatted.defaultUnitPrice">{{ item.documents[0].data.calculatedPrices.formatted.defaultUnitPrice }}</span> /
                                                
                                            <span v-if="true" class="base-price-amount" v-resource-bind:currentVariation="documents.0.data.unit.content" v-resource-if:currentVariation="documents[0].data.unit.content > 1">{{ item.documents[0].data.unit.content }}</span>

                                            <span class="base-price-amount" v-resource-bind:currentVariation="documents.0.data.unit.names.name">{{ item.documents[0].data.unit.names.name }}</span>
                                        </div>

                                        
                                        <span class="vat small text-muted">
                                            {{ trans("Ceres::Template.itemInclVAT") }} {{ trans("Ceres::Template.itemExclusive") }}
                                            <a href="/webshop/versand/" title="{{ trans("Ceres::Template.itemShippingCosts") }}">{{ trans("Ceres::Template.itemShippingCosts") }}</a>
                                        </span>

                                    </div>
                                </div>
                                
                                
                                
                                <add-to-basket template="#vue-add-to-basket" v-resource-push:item data-accessor="true" resource="currentVariation" :show-quantity="true"></add-to-basket>
                               

                                 {% if ('item.shortDescription' in itemData or 'all' in itemData) and item.documents[0].data.texts.shortDescription != '' %}
                                    <h3 class="hidden-md-up">Kurzbeschreibung</h3>
                                    <p class="single-description hidden-md-up">{{ item.documents[0].data.texts.shortDescription }}<br />
                                    <a id="description-mobile" href="#"><i class="fa fa-angle-double-right" aria-hidden="true"></i> Mehr</a>
                                    </p>
                                {% endif %}
                            </div>
                        </div>


                        

                        {% if crossSellingItemsSimilar | length > 0 %}

                            {% set crossSimilarItemIds = [] %}
                            
                            {% for crossSimilarItem in crossSellingItemsSimilar %}
                                {% if crossSimilarItemIds | length < 8 %}
                                    {% set crossSimilarItemIds = crossSimilarItemIds|merge([crossSimilarItem.crossItemId]) %}
                                {% endif %}
                            {% endfor %}
                            
                            {% set crossSimilarItemDetails = services.itemLoader.loadForTemplate('Kiom::ItemList.ItemListView', itemLoaderPresets.items, {'itemIds':crossSimilarItemIds}) %}
                            
                            <h3>Ähnliche Artikel</h3>
                            <ul class="product-list row grid crossselling-list crossselling-similar">
                                {% for item in crossSimilarItemDetails.documents %}
                                    <li class="col-xs-6">
                                        {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}<!-- ./Ähnliche Artikel -->


                        

                    </div><!-- ./ITEM DETAIL -->

                    <!-- ITEM DESCRIPTION -->
                    <div class="col-md-7 m-y-3">

                        <ul class="nav nav-tabs" role="tablist" id="single-tabs">
                            {% if not item.documents[0].data.texts.description == '' and('item.description' in itemData or 'all' in itemData) %}
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#details-{{ item.documents[0].data.variation.id }}"
                                       role="tab">{{ trans("Ceres::Template.itemDescription") }}</a>
                                </li>
                            {% endif %}
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="details-{{ item.documents[0].data.variation.id }}" role="tabpanel">
                                <div class="m-y-2">
                                    {{ item.documents[0].data.texts.description|raw }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ./ITEM DESCRIPTION -->
                </div>
                

                <div class="row">
                    <div class="col-xs-12">

                        {% if crossSellingItemsAccessory | length > 0 %}

                            {% set crossAccessoryItemIds = [] %}
                            
                            {% for crossAccessoryItem in crossSellingItemsAccessory %}
                                {% if crossAccessoryItemIds | length < 4 %}
                                    {% set crossAccessoryItemIds = crossAccessoryItemIds|merge([crossAccessoryItem.crossItemId]) %}
                                {% endif %}
                            {% endfor %}
                            
                            {% set crossAccessoryItemDetails = services.itemLoader.loadForTemplate('Kiom::ItemList.ItemListView', itemLoaderPresets.items, {'itemIds':crossAccessoryItemIds}) %}
                            
                            <h3>Zubehör</h3>
                            <ul class="product-list row grid crossselling-list crossselling-accessory">
                                {% for item in crossAccessoryItemDetails.documents %}
                                    <li class="col-xs-6 col-md-3">
                                        {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                    </li>
                                {% endfor %}
                            </ul>
                        {% endif %}

                    </div>
                </div><!-- ./Zubehör -->

                <div class="row prop-row m-y-2 sale-new">
                    <div class="col-xs-6">
                        <div class="prop-xs-6-4 prop-md-3-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="{{ services.category.getURL(newId, lang) }}">

                                    <img src="/documents/{{ newId.details[0].imagePath }}" alt="New">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> New
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-6">
                        <div class="prop-xs-6-4 prop-md-3-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="{{ services.category.getURL(saleId, lang) }}">

                                    <img src="/documents/{{ saleId.details[0].imagePath }}" alt="Sale">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> Sale
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
               


                <div class="row">
                    <div class="col-xs-12">
                        <h3>Zuletzt angesehen</h3>
                        {# LayoutContainer.show("Ceres::SingleItem.ItemListContainer", item.documents[0].data) #}

                        {% set itemListLastSeen = services.itemLoader.loadForTemplate('Ceres::Containers.ItemLists.LastSeenItemList', itemLoaderPresets.lastSeenItemsList, {'items':itemsPerPage}).documents %}
                        <ul class="product-list row grid crossselling-list crossselling-accessory">
                            {% for item in itemListLastSeen %}
                                <li class="col-xs-6 col-md-3">
                                    {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>

                    </div>
                </div><!-- ./Zuletzt angesehen -->

                <div class="row prop-row m-y-2 sale-new">
                    <div class="col-xs-12">
                        <div class="prop-xs-2-1 prop-md-4-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="/innenleuchten">

                                    <img src="/documents/category/16/Innenleuchten-kat1.jpg" alt="Innenleuchten">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> Highlight: Innenleuchten
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>


                    {{ LayoutContainer.show("Ceres::SingleItem.AddDetailTabsContent") }}
                </div>
            </div>
        </div>

        <!-- ./ITEM DESCRIPTION -->

        {{ LayoutContainer.show("Ceres::SingleItem.ItemListContainer", item) }}

        {#<hr>#}

        {#<h3 class="m-t-3 m-b-1">{{ trans("Ceres::Template.itemCustomerFeedback") }}</h3>#}
        {#<div class="row m-b-3">#}
            {#{% include "Ceres::Item.Partials.ItemRating" %}#}
        {#</div>#}


    </div>

{% endblock %}